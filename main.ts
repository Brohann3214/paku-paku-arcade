controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    if (gamestart) {
        if (mySprite.vx > 0) {
            mySprite.vx = -50
        } else {
            mySprite.vx = 50
        }
    }
})
controller.left.onEvent(ControllerButtonEvent.Pressed, function () {
    if (gamestart) {
        mySprite.vx = -50
    }
})
controller.right.onEvent(ControllerButtonEvent.Pressed, function () {
    if (gamestart) {
        mySprite.vx = 50
    }
})
function generate_pellets () {
    mySprite2 = sprites.create(img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `, SpriteKind.Player)
    tiles.placeOnRandomTile(mySprite2, assets.tile`myTile2`)
    tiles.setTileAt(mySprite2.tilemapLocation(), assets.tile`myTile7`)
    tileUtil.replaceAllTiles(assets.tile`myTile2`, assets.tile`myTile6`)
}
sprites.onOverlap(SpriteKind.Player, SpriteKind.Enemy, function (sprite, otherSprite) {
    if (vulnerable) {
        if (!(dead)) {
            score += 100
            characterAnimations.setCharacterAnimationsEnabled(mySprite3, false)
            animation.runImageAnimation(
            mySprite3,
            [img`
                . . . . . . . . 
                . . . . . . . . 
                . . . 1 1 . 1 1 
                . . . 1 f . 1 f 
                . . . . . . . . 
                . . . . . . . . 
                . . . . . . . . 
                . . . . . . . . 
                `],
            500,
            false
            )
            vulnerable = true
            dead = true
            mySprite3.vx = 50
            if (mySprite3.tilemapLocation().column == 20) {
                timer.after(2000, function () {
                    characterAnimations.setCharacterAnimationsEnabled(mySprite3, true)
                    dead = false
                })
            } else {
                pauseUntil(() => mySprite3.tilemapLocation().column == 20)
                characterAnimations.setCharacterAnimationsEnabled(mySprite3, true)
                timer.after(1000, function () {
                    dead = false
                })
            }
        }
    } else {
        if (gamestart) {
            gamestart = false
            mySprite.vx = 0
            mySprite3.vx = 0
            if (characterAnimations.matchesRule(mySprite, characterAnimations.rule(Predicate.MovingRight))) {
                characterAnimations.setCharacterAnimationsEnabled(mySprite, false)
                animation.runImageAnimation(
                mySprite,
                [img`
                    . . 5 5 5 5 5 . 
                    . 5 5 5 5 . . . 
                    5 5 5 5 . . . . 
                    5 5 5 . . . . . 
                    5 5 5 . . . . . 
                    5 5 5 5 . . . . 
                    . 5 5 5 5 . . . 
                    . . 5 5 5 5 5 . 
                    `,img`
                    . . 5 5 5 . . . 
                    . 5 5 5 5 . . . 
                    5 5 5 5 . . . . 
                    5 5 5 . . . . . 
                    5 5 5 . . . . . 
                    5 5 5 5 . . . . 
                    . 5 5 5 5 . . . 
                    . . 5 5 5 . . . 
                    `,img`
                    . 5 5 5 . . . . 
                    . 5 5 5 5 . . . 
                    5 5 5 5 . . . . 
                    . 5 5 5 . . . . 
                    . 5 5 5 . . . . 
                    5 5 5 5 . . . . 
                    . 5 5 5 5 . . . 
                    . 5 5 5 . . . . 
                    `,img`
                    . 5 5 . . . . . 
                    . 5 5 5 . . . . 
                    5 5 5 5 . . . . 
                    . 5 5 5 . . . . 
                    . 5 5 5 . . . . 
                    5 5 5 5 . . . . 
                    . 5 5 5 . . . . 
                    . 5 5 . . . . . 
                    `,img`
                    . 5 . . . . . . 
                    5 5 5 . . . . . 
                    5 5 5 . . . . . 
                    . 5 5 5 . . . . 
                    . 5 5 5 . . . . 
                    5 5 5 . . . . . 
                    5 5 5 . . . . . 
                    . 5 . . . . . . 
                    `,img`
                    . . . . . . . . 
                    5 5 . . . . . . 
                    5 5 5 . . . . . 
                    . 5 5 5 . . . . 
                    . 5 5 5 . . . . 
                    5 5 5 . . . . . 
                    5 5 . . . . . . 
                    . . . . . . . . 
                    `,img`
                    . . . . . . . . 
                    . . . . . . . . 
                    5 5 . . . . . . 
                    . 5 5 5 . . . . 
                    . 5 5 5 . . . . 
                    5 5 . . . . . . 
                    . . . . . . . . 
                    . . . . . . . . 
                    `,img`
                    . . . . . . . . 
                    . . . . . . . . 
                    . . . . . . . . 
                    5 5 5 . . . . . 
                    . . . . . . . . 
                    . . . . . . . . 
                    . . . . . . . . 
                    . . . . . . . . 
                    `,img`
                    . . . 5 . . . . 
                    . 5 . . . . 5 . 
                    . . 5 . . 5 . . 
                    . 5 . . . . . . 
                    . . . . 5 . . 5 
                    . 5 . 5 . . . . 
                    5 . . . . . 5 . 
                    . . . 5 . . . 5 
                    `],
                250,
                false
                )
            } else {
                characterAnimations.setCharacterAnimationsEnabled(mySprite, false)
                animation.runImageAnimation(
                mySprite,
                [img`
                    . 5 5 5 5 5 . . 
                    . . . 5 5 5 5 . 
                    . . . . 5 5 5 5 
                    . . . . . 5 5 5 
                    . . . . . 5 5 5 
                    . . . . 5 5 5 5 
                    . . . 5 5 5 5 . 
                    . 5 5 5 5 5 . . 
                    `,img`
                    . . . 5 5 5 . . 
                    . . . 5 5 5 5 . 
                    . . . . 5 5 5 5 
                    . . . . . 5 5 5 
                    . . . . . 5 5 5 
                    . . . . 5 5 5 5 
                    . . . 5 5 5 5 . 
                    . . . 5 5 5 . . 
                    `,img`
                    . . . . 5 5 5 . 
                    . . . 5 5 5 5 . 
                    . . . . 5 5 5 5 
                    . . . . 5 5 5 . 
                    . . . . 5 5 5 . 
                    . . . . 5 5 5 5 
                    . . . 5 5 5 5 . 
                    . . . . 5 5 5 . 
                    `,img`
                    . . . . . 5 5 . 
                    . . . . 5 5 5 . 
                    . . . . 5 5 5 5 
                    . . . . 5 5 5 . 
                    . . . . 5 5 5 . 
                    . . . . 5 5 5 5 
                    . . . . 5 5 5 . 
                    . . . . . 5 5 . 
                    `,img`
                    . . . . . . 5 . 
                    . . . . . 5 5 5 
                    . . . . . 5 5 5 
                    . . . . 5 5 5 . 
                    . . . . 5 5 5 . 
                    . . . . . 5 5 5 
                    . . . . . 5 5 5 
                    . . . . . . 5 . 
                    `,img`
                    . . . . . . . . 
                    . . . . . . 5 5 
                    . . . . . 5 5 5 
                    . . . . 5 5 5 . 
                    . . . . 5 5 5 . 
                    . . . . . 5 5 5 
                    . . . . . . 5 5 
                    . . . . . . . . 
                    `,img`
                    . . . . . . . . 
                    . . . . . . . . 
                    . . . . . . 5 5 
                    . . . . 5 5 5 . 
                    . . . . 5 5 5 . 
                    . . . . . . 5 5 
                    . . . . . . . . 
                    . . . . . . . . 
                    `,img`
                    . . . . . . . . 
                    . . . . . . . . 
                    . . . . . . . . 
                    . . . . . 5 5 5 
                    . . . . . . . . 
                    . . . . . . . . 
                    . . . . . . . . 
                    . . . . . . . . 
                    `,img`
                    . . . 5 . . . . 
                    . 5 . . . . 5 . 
                    . . 5 . . 5 . . 
                    . 5 . . . . . . 
                    . . . . 5 . . 5 
                    . 5 . 5 . . . . 
                    5 . . . . . 5 . 
                    . . . 5 . . . 5 
                    `],
                250,
                false
                )
            }
            music.stopAllSounds()
            music.play(music.createSong(gameoversong), music.PlaybackMode.InBackground)

            timer.after(2750, function() {
                game.reset()
            })
            
        }
    }
})
let mySprite2: Sprite = null
let dead = false
let gamestart = false
let vulnerable = false
let mySprite3: Sprite = null
let mySprite: Sprite = null
let score = 0
scene.setBackgroundImage(img`
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    .........caaaaaaaaaaaac........caaaaaaac...caaaaaaaccaaaaaaaaaaaaac..caaaaaaaccaaaaaaaaaaaac........aaaaaaac....caaaaaacccaaaaaaaaaaaaac..caaaaaaa..............
    ........caaaaaaaaaaaaaaac.....caaaaaaaaa..caaaaaaaaaaaaaaaaaaaaaaaaccaaaaaaaaaaaaaaaaaaaaaaaac.....aaaaaaaaac..caaaaaaaaaaaaaaaaaaaaaaaa.caaaaaaaaa.............
    ........cab5555555554baaaa....aa445bb4aac.cab44bb4aaab44b44a4bb44aaccaa4bb44aaab5555555554baaac...caa4b44b4aac.aabb44bbaaa4b44b4a44bb4aaccaa44bb4aa.............
    ........cab545555555555baac..caa555555bac.cab55555aaa555555a55555aaccaa55555aaa4555555555555aaac..cab555555aac.aa455554aaa555554a55555aacaab55555aac............
    ........cab5555555555555baac.aab5555555aaccab55555aab55555ba55555aaccaa55555aaa45555555555555aaa.caa54555554aacaa455554aa555555aa55555aacaab55555aac............
    ........cab55455555555555aaccaa55555555aaccab55555aa555555aa55555aaccaa55555aaa455555555555555aaccaa55555555aacaa455554ab555554aa55555aacaab55555aac............
    ........cab55545555555555baacab554555554aacab55555ab55555baa55555aaccaa55555aaa4555b5555555555aacaab55455555baaaa455554a555555aaa55555aacaab55555aac............
    ........cab55555bbbb555554aaaa4555555555aaaab55555a555555aaa55555aaccaa55555aaa455555bbb455555baaaa5555555554aaaa455554b555554aaa55555aacaab55555aac............
    ........cab55555aaaa455555aaaa5555455555baaab55555455555baaa55555aaccaa55555aaa455554aaaa555554aaab5555555555aaaa455554555555aaaa55555aacaab55555aac............
    ........cab555555555555554aaab55555555555aaab55555555555aaaa55555aaccaa55555aaa455555555555555baaa45555555555baaa455554555554aaaa55555aacaab55555aac............
    ........cab55555555555555baaa555555455555aaab55555555554aaaa55555aaccaa55555aaa455555555555555aaaa555554555555aaa45555555555baaaa55555aacaab55555aac............
    ........cab55555555555555aaaa55555ba555554aab55555555555aaaa55555baaaaa55555aaa455555555555554aaab55555ab55555baa455554555555aaaa55555aaaaab55555aac............
    ........cab5555555555455aaaa45555544555555aab55555a555554aaa555555aaaa455555aaa45555555555555aaaa55555544555554aa455554b55555baaa555554aaaa555555aa.............
    ........cab555555555554aaaaa55555555555555bab55555a555555aaa4555555bb5555555aaa455555555555baaaab55555555555555aa455554a555555aaa5555555b4555555baa.............
    ........cab55555aaaaaaaaaaab555555555555555ab55555aa555554aaa55555555555555baaa455554aaaaaaaaaaa455555555555555ba455554ab55555baab55555555555555aac.............
    ........cab55555aaaaaaaacaa5555555555555555ab55555aa455555aaab5555555555554aaaa455554aaaaaaaacaa5555555555555555a455554aa555555aaa4555555555555baac.............
    ........cab55555aaaaaac.caa55555bbbbbb55555bb55555aaa555554aaab5555555555baaaaa455554aaaaacc.aab55555bbbbbb55555b455554aab55555baaa45555555555baac..............
    ........cab55545aa......aa455555aaaaaa555555b55545aaa455555aaaab55555555baaacaa445544aa.....caa555555aaaaaa555554445544aaa555555aaaa455555555baaa...............
    ........caaaaaaaaa......aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaab4554baaaac.aaaaaaaaac.....caaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaab4554baaaac...............
    ........caaaaaaaac......caaaaaaaac..caaaaaaaaaaaaaaaaaaaaaaaacaaaaaaaaaaaa...caaaaaaaac......caaaaaaaac..caaaaaaaaaaaaaaaaaaaaaaaacaaaaaaaaaaac.................
    ..........caaaaac........caaaaaac....caaaaaaaaaaaac..caaaaaac...caaaaaaac.....caaaaaac........caaaaaac....caaaaaaaaaaaac.caaaaaaa...caaaaaaac...................
    ...................................................................cc...................................................................cc......................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    `)
if (!(blockSettings.exists("highscore"))) {
    blockSettings.writeNumber("highscore", 0)
}
tiles.setCurrentTilemap(tileUtil.createSmallMap(tilemap`level2`))
let myTextSprite2 = fancyText.create("BEST:" + blockSettings.readNumber("highscore"), 0, 1, fancyText.rounded_small)
let scorecount = fancyText.create("SCORE:" + score, 0, 1, fancyText.rounded_small)
let myTextSprite = fancyText.create("PRESS A TO START", 0, 1, fancyText.rounded_small)
scorecount.setPosition(80, 90)
myTextSprite2.setPosition(80, 8)
myTextSprite.setPosition(88, 45)
mySprite = sprites.create(img`
    . 5 5 5 5 5 . . 
    5 5 5 5 5 5 5 . 
    . . 5 5 5 5 5 5 
    . . . . 5 5 5 5 
    . . . . 5 5 5 5 
    . . 5 5 5 5 5 5 
    5 5 5 5 5 5 5 . 
    . 5 5 5 5 5 . . 
    `, SpriteKind.Player)
mySprite3 = sprites.create(img`
    . . 2 2 2 2 2 . 
    . 2 2 2 2 2 2 2 
    . 2 2 1 1 2 1 1 
    . 2 2 1 f 2 1 f 
    . 2 2 2 2 2 2 2 
    . 2 2 2 2 2 2 2 
    . 2 2 2 2 2 2 2 
    . 2 . 2 . 2 . 2 
    `, SpriteKind.Enemy)
tiles.placeOnTile(mySprite, tiles.getTileLocation(5, 7))
mySprite.x += -1
tiles.placeOnTile(mySprite3, tiles.getTileLocation(15, 7))
scene.centerCameraAt(88, 60)
characterAnimations.loopFrames(
mySprite3,
[img`
    . . 2 2 2 2 2 . 
    . 2 2 2 2 2 2 2 
    . 2 2 1 1 2 1 1 
    . 2 2 1 f 2 1 f 
    . 2 2 2 2 2 2 2 
    . 2 2 2 2 2 2 2 
    . 2 2 2 2 2 2 2 
    . 2 . 2 . 2 . 2 
    `,img`
    . . 2 2 2 2 2 . 
    . 2 2 2 2 2 2 2 
    . 2 2 1 1 2 1 1 
    . 2 2 1 f 2 1 f 
    . 2 2 2 2 2 2 2 
    . 2 2 2 2 2 2 2 
    . 2 2 2 2 2 2 2 
    . . 2 . 2 . 2 . 
    `],
100,
characterAnimations.rule(Predicate.MovingRight)
)
characterAnimations.loopFrames(
mySprite3,
[img`
    . 2 2 2 2 2 . . 
    2 2 2 2 2 2 2 . 
    1 1 2 1 1 2 2 . 
    f 1 2 f 1 2 2 . 
    2 2 2 2 2 2 2 . 
    2 2 2 2 2 2 2 . 
    2 2 2 2 2 2 2 . 
    2 . 2 . 2 . 2 . 
    `,img`
    . 2 2 2 2 2 . . 
    2 2 2 2 2 2 2 . 
    1 1 2 1 1 2 2 . 
    f 1 2 f 1 2 2 . 
    2 2 2 2 2 2 2 . 
    2 2 2 2 2 2 2 . 
    2 2 2 2 2 2 2 . 
    . 2 . 2 . 2 . . 
    `],
100,
characterAnimations.rule(Predicate.MovingLeft)
)
characterAnimations.loopFrames(
mySprite,
[img`
    . . 5 5 5 5 . . 
    . 5 5 5 5 5 5 . 
    5 5 5 5 5 5 5 5 
    5 5 5 5 5 5 5 5 
    5 5 5 5 5 5 5 5 
    5 5 5 5 5 5 5 5 
    . 5 5 5 5 5 5 . 
    . . 5 5 5 5 . . 
    `,img`
    . . 5 5 5 5 5 . 
    . 5 5 5 5 5 5 5 
    5 5 5 5 5 5 . . 
    5 5 5 5 . . . . 
    5 5 5 5 . . . . 
    5 5 5 5 5 5 . . 
    . 5 5 5 5 5 5 5 
    . . 5 5 5 5 5 . 
    `,img`
    . . 5 5 5 5 5 . 
    . 5 5 5 5 . . . 
    5 5 5 5 . . . . 
    5 5 5 . . . . . 
    5 5 5 . . . . . 
    5 5 5 5 . . . . 
    . 5 5 5 5 . . . 
    . . 5 5 5 5 5 . 
    `,img`
    . . 5 5 5 5 5 . 
    . 5 5 5 5 5 5 5 
    5 5 5 5 5 5 . . 
    5 5 5 5 . . . . 
    5 5 5 5 . . . . 
    5 5 5 5 5 5 . . 
    . 5 5 5 5 5 5 5 
    . . 5 5 5 5 5 . 
    `],
75,
characterAnimations.rule(Predicate.MovingRight)
)
characterAnimations.loopFrames(
mySprite,
[img`
    . . 5 5 5 5 . . 
    . 5 5 5 5 5 5 . 
    5 5 5 5 5 5 5 5 
    5 5 5 5 5 5 5 5 
    5 5 5 5 5 5 5 5 
    5 5 5 5 5 5 5 5 
    . 5 5 5 5 5 5 . 
    . . 5 5 5 5 . . 
    `,img`
    . 5 5 5 5 5 . . 
    5 5 5 5 5 5 5 . 
    . . 5 5 5 5 5 5 
    . . . . 5 5 5 5 
    . . . . 5 5 5 5 
    . . 5 5 5 5 5 5 
    5 5 5 5 5 5 5 . 
    . 5 5 5 5 5 . . 
    `,img`
    . 5 5 5 5 5 . . 
    . . . 5 5 5 5 . 
    . . . . 5 5 5 5 
    . . . . . 5 5 5 
    . . . . . 5 5 5 
    . . . . 5 5 5 5 
    . . . 5 5 5 5 . 
    . 5 5 5 5 5 . . 
    `,img`
    . 5 5 5 5 5 . . 
    5 5 5 5 5 5 5 . 
    . . 5 5 5 5 5 5 
    . . . . 5 5 5 5 
    . . . . 5 5 5 5 
    . . 5 5 5 5 5 5 
    5 5 5 5 5 5 5 . 
    . 5 5 5 5 5 . . 
    `],
75,
characterAnimations.rule(Predicate.MovingLeft)
)
vulnerable = false
generate_pellets()
gamestart = false
pauseUntil(() => controller.A.isPressed())
music.stopAllSounds()
music.play(music.createSong(hex`00780004080200`), music.PlaybackMode.LoopingInBackground)
mySprite.vx = -50
scene.setBackgroundImage(img`
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    `)
gamestart = true
sprites.destroy(myTextSprite)
dead = false
game.onUpdate(function () {
    fancyText.setText(myTextSprite2, "BEST:" + blockSettings.readNumber("highscore"))
    fancyText.setText(scorecount, "SCORE:" + score)
    if (mySprite.tileKindAt(TileDirection.Center, assets.tile`myTile6`)) {
        tiles.setTileAt(mySprite.tilemapLocation(), assets.tile`myTile2`)
        score += 5
        music.play(music.createSong(hex`00f4010408020109010e02026400000403780000040a000301000000640001c80000040100000000640001640000040100000000fa0004af00000401c80000040a00019600000414000501006400140005010000002c0104dc00000401fa0000040a0001c8000004140005d0076400140005d0070000c800029001f40105c201f4010a0005900114001400039001000005c201f4010500058403050032000584030000fa00049001000005c201f4010500058403c80032000584030500640005840300009001049001000005c201f4010500058403c80064000584030500c8000584030000f40105ac0d000404a00f00000a0004ac0d2003010004a00f0000280004ac0d9001010004a00f0000280002d00700040408070f0064000408070000c80003c800c8000e7d00c80019000e64000f0032000e78000000fa00032c01c8000ee100c80019000ec8000f0032000edc000000fa0003f401c8000ea901c80019000e90010f0032000ea4010000fa0001c8000004014b000000c800012c01000401c8000000c8000190010004012c010000c80002c800000404c8000f0064000496000000c80002c2010004045e010f006400042c010000640002c409000404c4096400960004f6090000f40102b80b000404b80b64002c0104f40b0000f401022003000004200300040a000420030000ea01029001000004900100040a000490010000900102d007000410d0076400960010d0070000c8000600000001000107`), music.PlaybackMode.InBackground)
    }
    if (score > blockSettings.readNumber("highscore")) {
        blockSettings.writeNumber("highscore", score)
    }
    if (mySprite.tileKindAt(TileDirection.Center, assets.tile`myTile7`)) {
        score += 20
        tiles.setTileAt(mySprite.tilemapLocation(), assets.tile`myTile2`)
        music.play(music.createSong(hex`00f4010408020207001c00020a006400f4016400000400000000000000000000000000000000030c0000000400012404000800012508001c000e050046006603320000040a002d00000064001400013200020100020c0000000400012a04000800012c`), music.PlaybackMode.InBackground)
        vulnerable = true
        characterAnimations.loopFrames(
        mySprite3,
        [img`
            . . 8 8 8 8 8 . 
            . 8 8 8 8 8 8 8 
            . 8 8 1 1 8 1 1 
            . 8 8 8 8 8 8 8 
            . 8 8 1 8 1 8 8 
            . 8 1 8 1 8 1 8 
            . 8 8 8 8 8 8 8 
            . 8 . 8 . 8 . 8 
            `,img`
            . . 8 8 8 8 8 . 
            . 8 8 8 8 8 8 8 
            . 8 8 1 1 8 1 1 
            . 8 8 8 8 8 8 8 
            . 8 8 1 8 1 8 8 
            . 8 1 8 1 8 1 8 
            . 8 8 8 8 8 8 8 
            . . 8 . 8 . 8 . 
            `],
        100,
        characterAnimations.rule(Predicate.MovingRight)
        )
        characterAnimations.loopFrames(
        mySprite3,
        [img`
            . 8 8 8 8 8 . . 
            8 8 8 8 8 8 8 . 
            1 1 8 1 1 8 8 . 
            8 8 8 8 8 8 8 . 
            8 8 1 8 1 8 8 . 
            8 1 8 1 8 1 8 . 
            8 8 8 8 8 8 8 . 
            8 . 8 . 8 . 8 . 
            `,img`
            . 8 8 8 8 8 . . 
            8 8 8 8 8 8 8 . 
            1 1 8 1 1 8 8 . 
            8 8 8 8 8 8 8 . 
            8 8 1 8 1 8 8 . 
            8 1 8 1 8 1 8 . 
            8 8 8 8 8 8 8 . 
            . 8 . 8 . 8 . . 
            `],
        100,
        characterAnimations.rule(Predicate.MovingLeft)
        )
        timer.after(2000, function () {
            characterAnimations.loopFrames(
            mySprite3,
            [img`
                . . 1 1 1 1 1 . 
                . 1 1 1 1 1 1 1 
                . 1 1 f f 1 f f 
                . 1 1 1 1 1 1 1 
                . 1 1 f 1 f 1 1 
                . 1 f 1 f 1 f 1 
                . 1 1 1 1 1 1 1 
                . 1 . 1 . 1 . 1 
                `,img`
                . . 8 8 8 8 8 . 
                . 8 8 8 8 8 8 8 
                . 8 8 f f 8 f f 
                . 8 8 8 8 8 8 8 
                . 8 8 f 8 f 8 8 
                . 8 f 8 f 8 f 8 
                . 8 8 8 8 8 8 8 
                . . 8 . 8 . 8 . 
                `],
            100,
            characterAnimations.rule(Predicate.MovingRight)
            )
            characterAnimations.loopFrames(
            mySprite3,
            [img`
                . 1 1 1 1 1 . . 
                1 1 1 1 1 1 1 . 
                f f 1 f f 1 1 . 
                1 1 1 1 1 1 1 . 
                1 1 f 1 f 1 1 . 
                1 f 1 f 1 f 1 . 
                1 1 1 1 1 1 1 . 
                1 . 1 . 1 . 1 . 
                `,img`
                . 8 8 8 8 8 . . 
                8 8 8 8 8 8 8 . 
                1 1 8 1 1 8 8 . 
                8 8 8 8 8 8 8 . 
                8 8 1 8 1 8 8 . 
                8 1 8 1 8 1 8 . 
                8 8 8 8 8 8 8 . 
                . 8 . 8 . 8 . . 
                `],
            100,
            characterAnimations.rule(Predicate.MovingLeft)
            )
            timer.after(1000, function () {
                vulnerable = false
                characterAnimations.loopFrames(
                mySprite3,
                [img`
                    . . 2 2 2 2 2 . 
                    . 2 2 2 2 2 2 2 
                    . 2 2 1 1 2 1 1 
                    . 2 2 1 f 2 1 f 
                    . 2 2 2 2 2 2 2 
                    . 2 2 2 2 2 2 2 
                    . 2 2 2 2 2 2 2 
                    . 2 . 2 . 2 . 2 
                    `,img`
                    . . 2 2 2 2 2 . 
                    . 2 2 2 2 2 2 2 
                    . 2 2 1 1 2 1 1 
                    . 2 2 1 f 2 1 f 
                    . 2 2 2 2 2 2 2 
                    . 2 2 2 2 2 2 2 
                    . 2 2 2 2 2 2 2 
                    . . 2 . 2 . 2 . 
                    `],
                100,
                characterAnimations.rule(Predicate.MovingRight)
                )
                characterAnimations.loopFrames(
                mySprite3,
                [img`
                    . 2 2 2 2 2 . . 
                    2 2 2 2 2 2 2 . 
                    1 1 2 1 1 2 2 . 
                    f 1 2 f 1 2 2 . 
                    2 2 2 2 2 2 2 . 
                    2 2 2 2 2 2 2 . 
                    2 2 2 2 2 2 2 . 
                    2 . 2 . 2 . 2 . 
                    `,img`
                    . 2 2 2 2 2 . . 
                    2 2 2 2 2 2 2 . 
                    1 1 2 1 1 2 2 . 
                    f 1 2 f 1 2 2 . 
                    2 2 2 2 2 2 2 . 
                    2 2 2 2 2 2 2 . 
                    2 2 2 2 2 2 2 . 
                    . 2 . 2 . 2 . . 
                    `],
                100,
                characterAnimations.rule(Predicate.MovingLeft)
                )
            })
        })
    }
    if (mySprite.tileKindAt(TileDirection.Center, assets.tile`myTile8`) && mySprite.vx < 0) {
        tiles.placeOnRandomTile(mySprite, assets.tile`myTile9`)
    }
    if (mySprite.tileKindAt(TileDirection.Center, assets.tile`myTile9`) && mySprite.vx > 0) {
        tiles.placeOnRandomTile(mySprite, assets.tile`myTile8`)
    }
    if (tiles.getTilesByType(assets.tile`myTile6`).length == 0 && tiles.getTilesByType(assets.tile`myTile7`).length == 0) {
        score += 20
        generate_pellets()
    }
    if (gamestart) {
        if (vulnerable) {
            if (!(dead)) {
                if (mySprite.x < mySprite3.x) {
                    mySprite3.vx = 30
                } else {
                    mySprite3.vx = -30
                }
            }
        } else {
            if (!(dead)) {
                if (mySprite.x < mySprite3.x) {
                    mySprite3.vx = -51
                } else {
                    mySprite3.vx = 51
                }
            }
        }
        if (mySprite3.x > 20 * 8) {
            mySprite3.x = 20 * 8
        }
        if (mySprite3.x < 2 * 8) {
            mySprite3.x = 2 * 8
        }
    }
})
